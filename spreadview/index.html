<!DOCTYPE html>
<head>
    <title>Spreadview Demo</title>
    <style>
        .card-tmpl {
            border-radius: 5px;
            width: 95%;
            float:left;
            border: solid 1px #aac;
            background-color: #bbd;
            padding: 5px;
            margin: 5px;
        }
        @media only screen and (min-width: 660px) {
            .card-tmpl {
                width: 280px;
            }
        }
        .card-tmpl:hover {
            background-color: #aac;
        }
        .card-tmpl a {
            color: #000;
            text-decoration: none;
            display: inline-block;
            width: 100%;
            height: 100%;
        }
        .card-tmpl .name {
            font-weight: bold;
        }
        .card-figure {
            height: 80px;
            width: 80px;
            line-height: 80px;
            float:left;
            margin: 5px;
            background-color: white;
        }
        .logo {
            width: 100%;
            max-width: 75px;
            height: auto;
            max-height: 75px;
            vertical-align: middle;
        }
        .templates { display:none; }
    </style>
</head>
<body>
    <noscript>This site requires JavaScript</noscript>
    <h1>Spreadview</h1>

    <div class="templates">
        <div id="card-tmpl" class="card-tmpl">
            <a class="link" href="">
                <figure class="card-figure"><img class="logo" src=""></figure>
                <div class="name"></div>
                <div class="description with a space"></div>
            </a>
        </div>
    </div>

    <div id="card-list">
        <input type="text" class="search">
        <div class="list">
        </div>
    </div>
    <script src="js/papaparse.min.js"></script>
    <script src="js/list.min.js"></script>
    <script>
        var opts = {
            doc: 'https://docs.google.com/spreadsheets/d/1joWXuUGEVKkSKffhg1Ea20lrZoEEk-ORRmrwZ9L17hM/edit#gid=0',
            skip_lines: 1
        };

        var doc_csv = (function() {
            var csv_call = 'pub?output=csv';
            var path = opts.doc.split('/');
            if (path[path.length - 1].startsWith('edit')) path.pop();
            if (path[path.length - 1] != csv_call) path.push(csv_call);
            return path.join('/');
        })();
        Papa.parse(doc_csv, {
            download: true,
            complete: function(results) {
                var snipped = results.data.slice(opts.skip_lines || 0);

                //all data values pass through this function
                function cast_value(x) {
                    if (x.startsWith && x.startsWith('www.'))
                        return window.location.protocol + '//' + x;
                    return x;
                }

                //xform lines to array of objects indexed by header
                var headers = snipped[0];
                var indexed = snipped.slice(1).map(function(line) {
                    var o = {};
                    for(var i = 0; i < line.length; i++) {
                        o[headers[i]] = cast_value(line[i]);
                    }
                    return o;
                });

                //generate the cards
                var cardlist = new List('card-list', {
                    item: 'card-tmpl',
                    valueNames: [
                        'name',
                        'description with a space',
                        {
                            name: 'logo',
                            attr: 'src'
                        },
                        {
                            name: 'link',
                            attr: 'href'
                        }
                    ]
                }, indexed);
            }
        });

    </script>
</body>
